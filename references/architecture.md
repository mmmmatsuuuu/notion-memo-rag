# Architecture

## 1. 目的

本アプリは、Notionに蓄積された読書メモを
「意味検索」し、思考の起爆剤として活用するための
個人用RAGシステムである。

これはチャットボットではない。
答えを生成することが目的ではない。

目的は：

- 文脈から関連知見を引き出す
- 原典（一次資料）へ辿り着く導線を作る
- 思考を加速する

---

## 2. 基本思想

### 2.1 主役は「原文断片」

生成AIは補助。
主役は自分のメモ。

表示するのは：

- メモ原文（先頭400文字）
- 出典リンク
- 本情報

### 2.2 1メモ = 1ベクトル

MVPでは分割（chunking）は行わない。
精度改善は後回し。

### 2.3 topKは少数精鋭

- デフォルト = 6件
- 思考の起爆剤として十分な量
- ノイズを抑える

---

## 3. システム構成

### 3.1 技術スタック

- Next.js (App Router)
- Supabase (Postgres + pgvector)
- Supabase Auth (Google)
- OpenAI Embedding API (text-embedding-3-small)
- Notion API
- Vercel

---

## 4. データフロー

### 4.1 同期（インデックス作成）

1. NotionメモDBからページ取得
2. ブロックを再帰取得
3. テキストを改行結合
4. content_hash生成
5. embedding生成
6. Supabaseへ保存

保存単位：
1ページ = 1レコード

---

### 4.2 検索

1. ユーザーが文脈を入力
2. embedding生成
3. Supabaseで近傍検索
4. topK=6を取得
5. カード表示

---

### 4.3 一次資料導線

- クエリ候補生成（3〜6件）
- Google Scholarリンク表示
- Webスクレイピングは行わない

---

## 5. セキュリティ設計

- 個人専用（ALLOWED_EMAIL制限）
- 秘密鍵はサーバー側のみ
- Service Role Keyはクライアントに渡さない

---

## 6. 非目標（MVPでやらないこと）

- メモ分割（chunking）
- タグフィルタ
- 自動バックグラウンド同期
- Web検索の自動取得
- LLMによる高度な再構成

---

## 7. 将来の拡張余地

- chunking導入
- ハイブリッド検索（タグ + ベクトル）
- 再ランキング
- 関連メモのクラスタリング表示
- 自動要約保存

---

## 8. 設計原則

- まず動くものを作る
- 認知負荷を下げる
- UXを観察してから改善する
- 過剰設計を避ける

---

## 9. このアプリの定義

これは「思考支援ツール」である。

知識の断片を呼び起こし、
原典へ辿り着くための装置である。

思考は自分が行う。
