# プロジェクト: Notion Memo RAG（MVP）

## 目的

本アプリは、Notionに蓄積された読書メモを
「意味検索 + 根拠付きサジェスト」により、
思考の起爆剤として活用するための
個人用RAGシステムである。

これはチャットボットではない。
対話を続けることが目的ではない。

目的は：

- 文脈から関連するメモ断片を引き出す
- メモ断片を基に、思考を進める叩き台を得る
- 原典（一次資料）へ辿り着く導線を作る
- 思考を加速させる

---

## 技術スタック

- Next.js（App Router / TypeScript）
- Supabase（Postgres + pgvector）
- Supabase Auth（Google OAuth）
- OpenAI Embeddings（text-embedding-3-small / 1536次元）
- Notion API（メモDB + ブロック再帰取得）
- Vercel（ホスティング）

ローカル開発はDocker上でNext.jsのみ実行する。
Supabaseはクラウドを利用する。

---

## コア設計（MVP）

### 1メモ = 1ベクトル
メモの分割（chunking）は行わない。

### 検索件数（2段階）
- fetch_k = 20（検索取得件数）
- answer_k = 8（生成で使う件数）

まず広く取得し、生成では絞り込む。

### プレビュー
メモ本文の先頭400文字を表示する。

### 同期
- 手動実行（/admin）
- limit = 50 または all
- バックグラウンドジョブは実装しない

### UI導線
- ログイン後の検索画面は `/` に表示する（`/search` は作らない）
- 入力は単一の `query` として画面下部固定ツールバーに配置する
- `/admin` への導線は同ツールバーに配置する
- 検索結果に応じた生成文と根拠カードを同時表示する
- 一次資料導線（Scholarクエリ）は各根拠カード内に表示する

---

## 非目標（MVPでは実装しない）

- メモの自動分割
- タグフィルタ検索
- Web検索の自動取得
- 自律的な長時間チャット体験
- 過剰な最適化

---

## セキュリティ

以下は絶対にクライアントへ渡さない：

- NOTION_TOKEN
- OPENAI_API_KEY
- SUPABASE_SERVICE_ROLE_KEY

すべてのAPIルートで：

1. 認証確認
2. ALLOWED_EMAIL一致確認

を必ず行う。

ログには秘密情報やメモ全文を出力しない。

---

## 実装原則

- まず動くものを作る
- 差分は小さく保つ
- MVP思想を壊さない
- 認知負荷を増やさない

設計を変更する場合は、
READMEおよびarchitecture.mdも更新すること。

---

## このアプリの定義

これは「思考支援装置」である。

主役は自分のメモ。
生成AIは補助である。

思考は自分が行う。
